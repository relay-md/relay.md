{% macro icon(name) %}
span.icon
 i{{name}}
{% endmacro %}

{% macro bool_icon(flag) %}
{% if flag %}
span.icon
 i.fas.fa-check
{% else %}
span.icon
 i.fas.fa-times
{% endif %}
{% endmacro %}

{% macro permissions(type, team_perms) %}
table.table
 {% for perm in Permissions %}
 tr
  td {{perm.name | replace("_", "-")}}
  td
   a(href="{{url_for('toggle_team_perms', team_name=team.name).include_query_params(perm=perm, type=type) | safe}}")
    {% if perm in Permissions(team_perms) %}
    i.fa.fa-check
    {% else %}
    i.fa.fa-times
    {% endif %}
 {% endfor %}
{% endmacro %}

{% macro member_permissions(member) %}
{% if not member.permissions %}
{% set perms = team.member_permissions %}
{% else %}
{% set perms = member.permissions %}
{% endif %}
{% for perm in Permissions %}
{% if perm.name != "can_join" %}
td.has-text-light
 a(class="{% if not member.permissions %}has-text-light{% endif %}" href="{{url_for('toggle_member_perms', team_name=team.name).include_query_params(perm=perm, member_id=member.id) | safe}}")
  {% if perm in Permissions(perms) %}
  i.fa.fa-check
  {% else %}
  i.fa.fa-times
  {% endif %}
{% endif %}
{% endfor %}
td.has-text-light
 a(class="{% if not member.permissions %}has-text-light{% endif %}" href="{{url_for('toggle_member_perms', team_name=team.name).include_query_params(member_id=member.id) | safe}}")
  i.fa.fa-redo
{% endmacro %}

{% extends 'layout.html' %} {% block title %}{{ name }} {% endblock %}
{% block content %}
.mt-5.mb-5
 .columns
  .column.is-8.is-offset-2
   .section
    .title.is-1 {{team.name}}
    {% if team.is_active and not team.is_public %}
    .subtitle paid until {{team.paid_until}}
    {% endif %}

   .section
    .block.title.is-3 Permissions
    .subtitle.is-5 Customize Team Permissions
    p.block Click the check marks/crosses to flip the corresponding permission.
    table.table.block
     tr
      th
       .icon-text
        .span.icon
         i.fa.fa-user
        span Owner
      th
       .icon-text
        .span.icon
         i.fa.fa-shield
        span Member
      th
       .icon-text
        .span.icon
         i.fa.fa-globe
        span Public
     tr
      td
       {{permissions("owner", team.owner_permissions)}}
      td
       {{permissions("member", team.member_permissions)}}
      td
       {{permissions("public", team.public_permissions)}}


   .section
    .block.title.is-3 Members
    .subtitle.is-5 List of users subscribed to your team
    p.block
     |Customize your members permissions. By default,&nbsp;
     span.is-underlined Team permissions apply!
    {% if members %}
    nav.block.pagination(role="navication" aria-label="pagination")
     {% if page %}
     a.pagination-previous(href="{{url_for('settings', team_name=team.name).include_query_params(type=type, size=size, page=page-1) | safe}}") Previous
     {% endif %}
     {% if documents | length == size %}
     a.pagination-next(href="{{url_for('settings', team_name=team.name).include_query_params(type=type, size=size, page=page+1) |safe}}") Next Page
     {% endif %}
     table.table
      thead
       tr
        th
         span.icon
          i.fas.fa-user
        td
        td(data-tooltip="Read")
         i.fas.fa-glasses
        td(data-tooltip="Post")
         i.fas.fa-pencil
        td(data-tooltip="Modify")
         i.fas.fa-edit
        td(data-tooltip="Create Topics")
         i.fas.fa-plus
        td(data-tooltip="Invite")
         i.fas.fa-user-plus
        td(data-tooltip="Reset to Team permissions")
         i.fas.fa-redo
        td
        td(data-tooltip="Remove")
          i.fas.fa-trash
      {% for member in members %}
      tr
       td {{member.user.username}}
       td
       {{ member_permissions(member) }}
       td
       td
        a.button.is-small(href="{{url_for('remove_user', team_name=team.name, membership_id=member.id)}}")
         span.icon.is-small
          i.fas.fa-trash
      {% endfor %}
     {% else %}
     p No members have joined yet.
     {% endif %}

   .section
    .block.title.is-3 Invite Users
    .subtitle.is-5 Add others to your team
    .control.has-icons-left
     input.input(type="tags" id="invite-users" name="name" hx-post="settings/user/search" hx-trigger="input changed delay:500ms, search" hx-target="#users")
     span.icon.is-left
      i.fas.fa-search
    div(id="users")

   {% if team.is_public or not team.paid_until %}
   .section.box.is-danger
    .block.title.is-3 Membership
    .subtitle.is-5 Upgrade to Private Member
    a.button.is-medium.is-danger.is-outlined(href="{{ url_for('team_billing', team_name=team.name) }}")
     span.icon.is-medium
      ðŸŽ‰
     span Upgrade to Private Team
    div(id="users")
   {% endif %}

{% endblock %}
